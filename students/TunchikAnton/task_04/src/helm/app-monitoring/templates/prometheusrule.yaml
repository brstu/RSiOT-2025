---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: {{ .Chart.Name }} -alerts
  namespace: {{ .Release.Namespace | default "default" }}
  labels:
    app: {{ .Chart.Name }}
    release: {{ .Values.prometheus.release }}
    org.bstu.course: "RSIOT"
    org.bstu.variant: "21"
    org.bstu.student.fullname: "Tunchik Anton Dmitrievich"
    org.bstu.student.id: "006326"
    org.bstu.group: "AC-63"
    slug: "ac-63--v21"
spec:
  groups:
  - name: {{ .Chart.Name }}-slo
    rules:
    - alert: App21HighErrorRate
      expr: |
        (
          sum(rate(app21_errors_total[5m]))
          / 
          sum(rate(app21_requests_total[5m]))
        ) * 100 > 2
      for: 1m
      labels:
        severity: warning
        variant: "21"
      annotations:
        summary: "High error rate detected"
        description: "Error rate is {{ $value }}% (threshold: 2%)"
        student: "Tunchik Anton Dmitrievich"