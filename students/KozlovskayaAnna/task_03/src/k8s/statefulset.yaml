---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: db-as63-220012-v8
  namespace: state-as63-220012-v8
  labels:
    app.kubernetes.io/name: redis
    app.kubernetes.io/instance: db-as63-220012-v8
    app.kubernetes.io/component: database
    app.kubernetes.io/part-of: redis-stateful
    org.bstu.student.fullname: "РљРѕР·Р»РѕРІСЃРєР°СЏ РђРЅРЅР° Р“РµРЅРЅР°РґСЊРµРІРЅР°"
    org.bstu.student.id: "220012"
    org.bstu.group: "РђРЎ-63"
    org.bstu.variant: "8"
    org.bstu.course: RSIOT
    org.bstu.owner: annkrq
    org.bstu.student.slug: as63-220012-v8
spec:
  serviceName: db-as63-220012-v8
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: db-as63-220012-v8
  template:
    metadata:
      labels:
        app.kubernetes.io/name: redis
        app.kubernetes.io/instance: db-as63-220012-v8
        app.kubernetes.io/component: database
        app.kubernetes.io/part-of: redis-stateful
        org.bstu.student.fullname: "РљРѕР·Р»РѕРІСЃРєР°СЏ РђРЅРЅР° Р“РµРЅРЅР°РґСЊРµРІРЅР°"
        org.bstu.student.id: "220012"
        org.bstu.group: "РђРЎ-63"
        org.bstu.variant: "8"
        org.bstu.course: RSIOT
        org.bstu.owner: annkrq
        org.bstu.student.slug: as63-220012-v8
    spec:
      terminationGracePeriodSeconds: 30
      containers:
        - name: redis
          image: redis:7.2-alpine
          imagePullPolicy: IfNotPresent
          ports:
            - name: redis
              containerPort: 6379
          env:
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: db-as63-220012-v8-secret
                  key: REDIS_PASSWORD
            - name: REDISCLI_AUTH
              valueFrom:
                secretKeyRef:
                  name: db-as63-220012-v8-secret
                  key: REDIS_PASSWORD
            - name: STU_ID
              value: "220012"
            - name: STU_GROUP
              value: "РђРЎ-63"
            - name: STU_VARIANT
              value: "8"
          command:
            - "/bin/sh"
            - "-c"
          args:
            - |
              echo "STU_ID=${STU_ID} STU_GROUP=${STU_GROUP}
              STU_VARIANT=${STU_VARIANT}";
              exec redis-server --appendonly yes
              --requirepass "${REDIS_PASSWORD}";
          livenessProbe:
            exec:
              command:
                - /bin/sh
                - -c
                - redis-cli -a "$REDIS_PASSWORD" ping
            initialDelaySeconds: 20
            periodSeconds: 10
            timeoutSeconds: 5
          readinessProbe:
            exec:
              command:
                - /bin/sh
                - -c
                - redis-cli -a "$REDIS_PASSWORD" ping
            initialDelaySeconds: 10
            periodSeconds: 5
            timeoutSeconds: 3
          volumeMounts:
            - name: redis-data
              mountPath: /data
      volumes: [ ]
  volumeClaimTemplates:
    - metadata:
        name: redis-data
        labels:
          app.kubernetes.io/name: redis
          app.kubernetes.io/instance: db-as63-220012-v8
          app.kubernetes.io/component: database
          app.kubernetes.io/part-of: redis-stateful
          org.bstu.student.fullname: "РљРѕР·Р»РѕРІСЃРєР°СЏ РђРЅРЅР° Р“РµРЅРЅР°РґСЊРµРІРЅР°"
          org.bstu.student.id: "220012"
          org.bstu.group: "РђРЎ-63"
          org.bstu.variant: "8"
          org.bstu.course: RSIOT
          org.bstu.owner: annkrq
          org.bstu.student.slug: as63-220012-v8
      spec:
        accessModes: ["ReadWriteOnce"]
        storageClassName: storage-as63-220012-v8-standard
        resources:
          requests:
            storage: 1Gi
