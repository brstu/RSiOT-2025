apiVersion: v1
kind: ConfigMap
metadata:
  name: app02-grafana-dashboard
  namespace: app02-monitoring
  labels:
    grafana_dashboard: "1"
    student: vyrzhemkovskiy-daniil
    group: ac-63
    variant: 2
data:
  app02-dashboard.json: |
    {
      "title": "App02 Monitoring - Вариант 2",
      "description": "Дашборд мониторинга для приложения app02. Студент: Выржемковский Даниил Иванович, Группа: AC-63",
      "tags": ["app02", "ac-63", "вариант-2"],
      "timezone": "browser",
      "panels": [
        {
          "title": "Доступность (SLO: 99.5%)",
          "type": "stat",
          "targets": [{
            "expr": "100 - ((1 - (rate(app02_http_requests_total{status=~\"2..\"}[5m]) / rate(app02_http_requests_total[5m]))) * 100)",
            "legendFormat": "Доступность"
          }],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "steps": [
                  {"color": "red", "value": 0},
                  {"color": "yellow", "value": 99.5},
                  {"color": "green", "value": 99.7}
                ]
              }
            }
          }
        },
        {
          "title": "Задержка p95 (SLO: <250ms)",
          "type": "stat",
          "targets": [{
            "expr": "histogram_quantile(0.95, rate(app02_http_request_duration_seconds_bucket[5m])) * 1000",
            "legendFormat": "p95 Latency"
          }],
          "fieldConfig": {
            "defaults": {
              "unit": "ms",
              "thresholds": {
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 200},
                  {"color": "red", "value": 250}
                ]
              }
            }
          }
        },
        {
          "title": "Error Rate (Alert: >1.5%)",
          "type": "stat",
          "targets": [{
            "expr": "(rate(app02_http_requests_total{status=~\"5..\"}[10m]) / rate(app02_http_requests_total[10m])) * 100",
            "legendFormat": "5xx Error Rate"
          }],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 1},
                  {"color": "red", "value": 1.5}
                ]
              }
            }
          }
        }
      ]
    }